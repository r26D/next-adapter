var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});var _exportNames={runAsync:true};exports.runAsync=runAsync;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _chalk=_interopRequireDefault(require("chalk"));var _prompts=_interopRequireDefault(require("prompts"));var _manifest=require("./manifest");Object.keys(_manifest).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;if(key in exports&&exports[key]===_manifest[key])return;Object.defineProperty(exports,key,{enumerable:true,get:function get(){return _manifest[key];}});});function _createForOfIteratorHelperLoose(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(it)return(it=it.call(o)).next.bind(it);if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;return function(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function logReady(){console.log();console.log(_chalk.default.reset("\u203A Your Expo + Next.js project has all of the required customizations."));console.log(_chalk.default.reset("\u203A Start your project with `"+_chalk.default.bold("yarn next dev")+"` to test it."));console.log();}function runNonInteractiveFlowAsync(projectRoot){var customizations,_iterator,_step,customization;return _regenerator.default.async(function runNonInteractiveFlowAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:customizations=_manifest.manifest.filter(function(_ref){var type=_ref.type;return type==='required';});_iterator=_createForOfIteratorHelperLoose(customizations);case 2:if((_step=_iterator()).done){_context.next=11;break;}customization=_step.value;_context.next=6;return _regenerator.default.awrap(customization.onEnabledAsync({projectRoot:projectRoot,force:false}));case 6:if(!_context.sent){_context.next=9;break;}_context.next=9;return _regenerator.default.awrap(customization.onSelectAsync({projectRoot:projectRoot,force:true}));case 9:_context.next=2;break;case 11:logReady();case 12:case"end":return _context.stop();}}},null,null,null,Promise);}function runAsync(_ref2){var projectRoot,force,nonInteractive,values,_iterator2,_step2,customization,enabled,_await$prompts,answer;return _regenerator.default.async(function runAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:projectRoot=_ref2.projectRoot,force=_ref2.force,nonInteractive=_ref2.yes;if(!nonInteractive){_context2.next=5;break;}_context2.next=4;return _regenerator.default.awrap(runNonInteractiveFlowAsync(projectRoot));case 4:return _context2.abrupt("return");case 5:values=[];_iterator2=_createForOfIteratorHelperLoose(_manifest.manifest);case 7:if((_step2=_iterator2()).done){_context2.next=15;break;}customization=_step2.value;_context2.next=11;return _regenerator.default.awrap(customization.onEnabledAsync({projectRoot:projectRoot,force:force}));case 11:enabled=_context2.sent;values.push({title:customization.name,value:customization.name,disabled:!force&&!enabled,message:force&&!enabled?_chalk.default.red('This will overwrite the existing file'):''});case 13:_context2.next=7;break;case 15:if(values.filter(function(_ref3){var disabled=_ref3.disabled;return!disabled;}).length){_context2.next=20;break;}logReady();console.log(_chalk.default.dim("\u203A To regenerate the files run: "+_chalk.default.bold('next-expo --force')));console.log();return _context2.abrupt("return");case 20:_context2.next=22;return _regenerator.default.awrap((0,_prompts.default)({type:'multiselect',name:'answer',message:'Which Next.js files would you like to generate?\n',hint:'- Space to select. Return to submit',warn:'File exists, use --force to overwrite it.',limit:values.length,instructions:'',choices:values}));case 22:_await$prompts=_context2.sent;answer=_await$prompts.answer;if(answer){_context2.next=27;break;}console.log("\n\u203A Exiting...\n");return _context2.abrupt("return");case 27:_context2.next=29;return _regenerator.default.awrap(Promise.all(answer.map(function(item){var customization=_manifest.manifest.find(function(_ref4){var name=_ref4.name;return name===item;});if(customization)return customization.onSelectAsync({projectRoot:projectRoot,force:force});else throw new Error('failed to find customization matching: '+item);}).filter(Boolean)));case 29:case"end":return _context2.stop();}}},null,null,null,Promise);}